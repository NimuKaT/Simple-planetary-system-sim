function numberToHex(t){var e=t.toString(16);return 1==e.length?"0"+e:e}function radiusToVolume(t){return 4/3*Math.PI*Math.pow(t,3)}function volumeToRadius(t){return Math.cbrt(3*t/4*Math.PI)}function object(t,e,n,o,s,i){this.id=i,this.x=o,this.y=s,this.radius=e,this.density=t,this.volume=radiusToVolume(e),this.mass=this.density*this.volume,this.color=n,this.vx=0,this.vy=0,this.ax=0,this.ay=0,this.orbitPath=[],this.drawObject=function(t,e,n,o){if(CANVAS_CONTEXT.beginPath(),CANVAS_CONTEXT.arc(this.x-t,this.y-e,this.radius,0,2*Math.PI,!1),CANVAS_CONTEXT.fillStyle=this.color,CANVAS_CONTEXT.fill(),CANVAS_CONTEXT.closePath(),CANVAS_CONTEXT.lineWidth=DEFAULT_LINE_WIDTH,1==showVelocity&&(CANVAS_CONTEXT.beginPath(),CANVAS_CONTEXT.moveTo(this.x-t,this.y-e),CANVAS_CONTEXT.lineTo(this.x-t+this.vx,this.y-e+this.vy),CANVAS_CONTEXT.strokeStyle="red",CANVAS_CONTEXT.stroke(),CANVAS_CONTEXT.closePath()),1==showAcceleration&&(CANVAS_CONTEXT.beginPath(),CANVAS_CONTEXT.moveTo(this.x-t,this.y-e),CANVAS_CONTEXT.lineTo(this.x-t+this.ax,this.y-e+this.ay),CANVAS_CONTEXT.strokeStyle="blue",CANVAS_CONTEXT.stroke(),CANVAS_CONTEXT.closePath()),1==showOrbitPath){var s=ORBIT_PATH_WIDTH_INITIAL;CANVAS_CONTEXT.beginPath(),CANVAS_CONTEXT.strokeStyle="green",CANVAS_CONTEXT.moveTo(this.x-t,this.y-e);for(var i=0;i<this.orbitPath.length;i++)CANVAS_CONTEXT.lineWidth=s,CANVAS_CONTEXT.lineTo(this.orbitPath[i][0]-t,this.orbitPath[i][1]-e),CANVAS_CONTEXT.stroke(),s-=ORBIT_PATH_WIDTH_DECREMENT;CANVAS_CONTEXT.closePath()}this.ax=0,this.ay=0},this.updatePosition=function(t){this.orbitPath.unshift([this.x,this.y]),this.orbitPath.length>ORBIT_PATH_LENGTH&&this.orbitPath.pop(),this.x+=this.vx*t/TICKS_PER_SECOND+.5*this.ax*Math.pow(t/TICKS_PER_SECOND,2),this.y+=this.vy*t/TICKS_PER_SECOND+.5*this.ay*Math.pow(t/TICKS_PER_SECOND,2),this.vx+=this.ax*t/TICKS_PER_SECOND,this.vy+=this.ay*t/TICKS_PER_SECOND},this.getX=function(){return this.x},this.getY=function(){return this.y},this.getMass=function(){return this.mass},this.getVolume=function(){return this.volume},this.getDensity=function(){return this.density},this.getRadius=function(){return this.radius},this.getColor=function(){return this.color},this.getVelocity=function(){return[this.vx,this.vy]},this.getID=function(){return this.id},this.setVelocity=function(t,e){this.vx=t,this.vy=e},this.setAcceleration=function(t,e){this.ax=t,this.ay=-e}}function calculateDistance(t,e,n,o){var s=Math.sqrt(Math.pow(t-n,2)+Math.pow(e-o,2));return s}function getAngleBetweenPoints(t,e,n,o){var s=180*Math.atan2(o-e,n-t)/Math.PI;return s*=-1}function calculateGravityAccel(t,e,n,o,s,i,a){var c=s/Math.pow(i,2),l=c*Math.sin(a*Math.PI/180),d=c*Math.cos(a*Math.PI/180);return[d,l]}function Main(){this.objects=[],this.magnificationMultiplyer=1,this.currentCoordinate=[0,0],this.idCounter=0,this.createObject=function(t,e,n,o,s,i,a){this.objects.push(new object(t,e,n,o,s,this.idCounter)),0===i&&0===a||this.objects[this.objects.length-1].setVelocity(i,a),console.log("Created object with\nDensity: "+t+"kg/m^3\nRadius: "+e+"km\nColor: "+n+"\nCoordinates: "+o+", "+s+"\nID: "+this.idCounter),this.idCounter++},this.update=function(){if("undefined"!=typeof this.objects){var t=[0,0],e=0,n=0;CANVAS_CONTEXT.clearRect(0,0,CANVAS.width,CANVAS.height);for(var o=0;o<this.objects.length;o++){t=[0,0];for(var s=0;s<this.objects.length;s++)if(this.objects[o].getID()!=this.objects[s].getID()){var i=0;e=getAngleBetweenPoints(this.objects[o].getX(),this.objects[o].getY(),this.objects[s].getX(),this.objects[s].getY()),n=calculateDistance(this.objects[o].getX(),this.objects[o].getY(),this.objects[s].getX(),this.objects[s].getY()),t=calculateGravityAccel(this.objects[o].getX(),this.objects[o].getY(),this.objects[s].getX(),this.objects[s].getY(),this.objects[s].getMass(),n,e)}this.objects[o].setAcceleration(t[0],t[1])}for(var o=0;o<this.objects.length;o++)this.objects[o].updatePosition(1),this.objects[o].drawObject(this.currentCoordinate[0],this.currentCoordinate[1]);updateObjManagement(this.objects)}},this.hitDetect=function(t,e){var n=!1,o=t.getX(),s=t.getY(),i=t.getRadius(),a=e.getX(),c=e.getY(),l=e.getRadius(),d=calculateDistance(o,s,a,c);return COLLISION_THRESHOLD*(i+l)>=d&&(n=!0),n},this.mergeObject=function(t){for(this.totalMomentum=[0,0],this.totalMass=0,this.totalVolume=0,i=0;i>t.length;i++){var e=t[i].getMass(),n=t[i].getVelocity;this.totalMomentum[0]=this.totalMomentum[0]+e*n[0],this.totalMomentum[1]=this.totalMomentum[1]+e*n[1],this.totalMass=this.totalMass+e,this.totalVolume=this.totalVolume+t[i].getVolume()}},this.getObject=function(t){return this.objects[t]},this.getIndexFromID=function(t){return t===this.value}}const CANVAS=document.getElementById("simulation"),CANVAS_CONTEXT=CANVAS.getContext("2d"),UNIVERSAL_GRAVITATIONAL_CONSTANT=6.67e-11,KM_TO_PIXELS=.001,COLLISION_THRESHOLD=.85,TICKS_PER_SECOND=25,ORBIT_PATH_LENGTH=100,ORBIT_PATH_WIDTH_INITIAL=5,ORBIT_PATH_WIDTH_DECREMENT=.1,DEFAULT_LINE_WIDTH=5;var session=new Main,showOrbitPath=!0,showVelocity=!1,showAcceleration=!1,openWindow=function(t){document.getElementById(t).className="open"},closeWindow=function(t){document.getElementById(t).className=""},initFollowObject=function(){document.onmousemove=function(t){t=t||window.event;var e=document.getElementById("object-undermouse");e.style.left=t.pageX-e.offsetWidth/2+"px",e.style.top=t.pageY-e.offsetHeight/2+"px"}};window.onresize=function(){CANVAS.width=.75*window.innerWidth,CANVAS.height=window.innerHeight};var init=function(){CANVAS.width=.75*window.innerWidth,CANVAS.height=window.innerHeight,initFollowObject(),openWindow("start"),document.getElementById("str-btn-tutorial").addEventListener("mousedown",function(){document.getElementById("start").className="",openWindow("tutorial")}),document.getElementById("str-btn-object").addEventListener("mousedown",function(){document.getElementById("start").className="",openWindow("object-creation")}),document.getElementById("str-btn-settings").addEventListener("mousedown",function(){document.getElementById("start").className="",openWindow("settings")}),document.getElementById("str-btn-loadstate").addEventListener("mousedown",function(){document.getElementById("start").className="",openWindow("load-state")}),document.getElementById("sidebar-return-tutorial").addEventListener("mousedown",function(){openWindow("start"),closeWindow("tutorial")}),document.getElementById("sidebar-return-objectcreation").addEventListener("mousedown",function(){openWindow("start"),closeWindow("object-creation")}),document.getElementById("sidebar-return-settings").addEventListener("mousedown",function(){openWindow("start"),closeWindow("settings")}),document.getElementById("sidebar-return-loadstate").addEventListener("mousedown",function(){openWindow("start"),closeWindow("load-state")})};init(),document.getElementById("object-material").onchange=function(){var t=document.getElementById("object-material");"0"===t.value?document.getElementById("object-material-custom").className="shown":document.getElementById("object-material-custom").className=""},document.getElementById("object-create").addEventListener("mouseup",function(){var t=document.getElementById("object-radius").value,e=document.getElementById("object-color").value,n=document.getElementById("object-material").value;"0"===n&&(n=document.getElementById("object-material-custom").value),createFollowObject(t,e,n)}),document.getElementById("object-generate-random").addEventListener("mouseup",function(){var t=Math.floor(190*Math.random()+10),e=Math.floor(255*Math.random()),n=Math.floor(255*Math.random()),o=Math.floor(255*Math.random()),s="#"+numberToHex(e)+numberToHex(n)+numberToHex(o),i=Math.floor(100*Math.random()+1);createFollowObject(t,s,i)});var createFollowObject=function(t,e,n){var o=document.getElementById("object-undermouse");o.style.display="block",o.style.background=e,o.style.width=2*t+"px",o.style.height=2*t+"px",document.getElementById("object-alert").className="shown",document.getElementById("object-alert").onmouseover=function(){var t=document.getElementById("object-alert");t.className="",t.mouseover=""},o.onclick=function(o){var s=o.pageX,i=o.pageY;createPlaceholderObject(t,e,s,i),createVelocityLine(s,i),clearFollowObject(),createObjectCancellation();var a=!1;document.onclick=function(o){if(a){var c=o.pageX-s,l=o.pageY-i;session.createObject(n,t,e,s,i,c,l),clearObjectCreation()}else a=!0}},createObjectCancellation(!0)},createObjectCancellation=function(t){t=t||!1;var e=!0;t&&(e=!1),document.getElementById("sidebar").onclick=function(){e&&clearObjectCreation(),e=!0},document.onkeydown=function(t){27===t.which&&clearObjectCreation()}},clearFollowObject=function(){var t=document.getElementById("object-undermouse");t.style.display="none",t.style.width="0px",t.style.height="0px",t.style.background="none",t.onclick=""},clearObjectCreation=function(){document.getElementById("sidebar").onclick="",document.onkeydown="",document.onclick="",document.getElementById("object-alert").className="",clearFollowObject(),removePlaceholderObject(),removeVelocityLine(),initFollowObject()},createPlaceholderObject=function(t,e,n,o){var s=document.getElementById("object-placeholder");s.style.width=2*t+"px",s.style.height=2*t+"px",s.style.background=e,s.style.left=n-t+"px",s.style.top=o-t+"px"},removePlaceholderObject=function(){var t=document.getElementById("object-placeholder");t.style.width="",t.style.height="",t.style.background="none",t.style.left="",t.style.top=""},createVelocityLine=function(t,e){var n=document.getElementById("velocity-line");n.style.left=t+"px",n.style.top=e+"px";var o=0;document.onmousemove=function(s){0===o&&(n.style.display="block",o++);var i=s.pageX,a=s.pageY,c=Math.hypot(i-t,a-e),l=180*Math.atan2(a-e,i-t)/Math.PI;n.style.width=c+"px",n.style.transform="rotate("+l+"deg)"}},removeVelocityLine=function(){var t=document.getElementById("velocity-line");t.style.display="none",t.style.left="",t.style.top="",t.style.width="",t.style.transform=""};document.getElementById("settings-velocity-line").onchange=function(){showVelocity=document.getElementById("settings-velocity-line").checked},document.getElementById("settings-acceleration-line").onchange=function(){showAcceleration=document.getElementById("settings-acceleration-line").checked},document.getElementById("settings-orbit-path").onchange=function(){showOrbitPath=document.getElementById("settings-orbit-path").checked};var updateObjManagement=function(t){for(var e=0;e<t.length;e++){var n=t[e],o=n.getID();if(document.getElementById("settings-o-"+o)){var s=n.getVelocity(),i="<span>Coordinates:&nbsp;&nbsp;<span>"+Math.floor(n.getX())+", "+Math.floor(n.getY())+"</span></span>";i+="<span>Velocity X:&nbsp;&nbsp;<span>"+Math.floor(s[0])+"km/hr</span></span>",i+="<span>Velocity Y:&nbsp;&nbsp;<span>"+Math.floor(s[1])+"km/hr</span></span>",document.getElementById("settings-o-changinginfo-"+o).innerHTML=i}else{var i='<div class="settings-object-wrap" id="settings-o-'+o+'">';i+='<div class="settings-o-color" style="background: '+n.getColor()+'"></div>',i+='<div class="settings-o-information">',i+="<span>Density:&nbsp;&nbsp;<span>",i+=+n.getDensity()+"kg/m^3</span></span>",i+="<span>Radius:&nbsp;&nbsp;<span>",i+=+n.getRadius()+"km</span></span>",i+='<div id="settings-o-changinginfo-'+o+'"></div>',i+='<button class="settings-o-delete" id="settings-o-delete-'+o+'" onclick="deleteObjectNum('+o+')">Delete</button>',i+="</div></div>",document.getElementById("object-management").innerHTML+=i}}0===t.length?(document.getElementById("object-management").innerHTML="No objects created.",document.getElementById("download-objects").className="disabled",document.getElementById("clear-objects").className="disabled"):(document.getElementById("download-objects").className="",document.getElementById("clear-objects").className="")},deleteObjectNum=function(t){if(confirm("Are you sure you wish to delete this object?\nObjects are not recoverable."))for(var e=0;e<session.objects.length;e++){var n=session.objects[e];if(n.getID()===t){session.objects.splice(e,1);var o=document.getElementById("settings-o-"+t);document.getElementById("object-management").removeChild(o)}}};document.getElementById("download-objects").onclick=function(){if("disabled"!=document.getElementById("download-objects").className){var t=JSON.stringify(session.objects,null,2),e=document.createElement("a");e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),e.setAttribute("download","objects.json"),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}},document.getElementById("clear-objects").onclick=function(){"disabled"!=document.getElementById("download-objects").className&&confirm("Are you sure you want to delete all objects?\nObjects are not recoverable.")&&(session.objects=[])};var sessionInterval=window.setInterval(function(){session.update()},40);